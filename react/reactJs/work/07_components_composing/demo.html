<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>05_component_props</title>
</head>

<body>
    <div id="example"></div>

    <script type="text/javascript" src="../js/react.development.js"></script>
    <script type="text/javascript" src="../js/react-dom.development.js"></script>
    <script type="text/javascript" src="../js/babel.min.js"></script>
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
       
       class App extends React.Component {

            constructor(props) {
                super(props)
                this.state = {
                    todos: ['吃饭', '睡觉', '打代码']
                }

                this.addTodo = this.addTodo.bind(this)
            }

            addTodo(todo) {
                //不能这样写:this.state.todos.unshift(todo)
                const {todos} = this.state
                todos.unshift(todo)
                this.setState({todos})
            }

           render() {

               const {todos} = this.state
               return (
                    <div>
                        <h1>Simple TODO List</h1>
                        <Add count={todos.length} addTodo={this.addTodo}/>
                        <List todos={this.state.todos}/>
                    </div>

               ) 
           }
       }

       class Add extends React.Component {

            constructor(props) {
                super(props)
                this.add = this.add.bind(this)
            }

           add() {
               //子组件中无法直接改变父组件状态没发用this.state 
               //1.读取输入的数据
               const todo = this.todoInput.value.trim()
               //2.校验输入合法性,这里不校验了
               if(!todo) {
                   return
               }
               //3.添加
               this.props.addTodo(todo)
               //4.清除输入
               this.todoInput.value = ''
           }

           render() {
               return (
                    <div>
                        <input type="text" ref={input => this.todoInput=input}/>
                        <button onClick={this.add}>add #{this.props.count+1}</button>
                    </div>
               )
           }
       }

       Add.propTypes = {
           count: PropTypes.number.isRequired,
           addTodo: PropTypes.func.isRequired
       }

       class List extends React.Component {
           render() {
               const {todos} = this.props
               return (
                   <ul>
                      {
                          this.props.todos.map((todo, index) => {return <li key={index}> {todo} </li>})
                      }
                   </ul>
               )
           }
       }

       List.propTypes = {
           todos: PropTypes.array.isRequired
       }

       ReactDOM.render(<App/>, document.getElementById('example'))
    </script>

</body>
</html>